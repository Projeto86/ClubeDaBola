(function(){scheduler.matrix={};scheduler.createTimelineView=function(M){var N=function(P,O){for(var Q in O){if(typeof P[Q]=="undefined"){P[Q]=O[Q]}}};N(M,{name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50});scheduler[M.name+"_view"]=function(){scheduler.renderMatrix.apply(M,arguments)};var L=scheduler.render_data;scheduler.render_data=function(O){if(this._mode==M.name){C.call(M,true)}else{return L.apply(this,arguments)}};scheduler.attachEvent("onOptionsLoad",function(){M.order={};for(var O=0;O<M.y_unit.length;O++){M.order[M.y_unit[O].key]=O}if(scheduler._date){scheduler.setCurrentView(scheduler._date,scheduler._mode)}});scheduler.callEvent("onOptionsLoad",[]);scheduler.matrix[M.name]=M;scheduler.templates[M.name+"_cell_value"]=function(O){return O?O.length:""};scheduler.templates[M.name+"_cell_class"]=function(O){return""};scheduler.templates[M.name+"_scalex_class"]=function(O){return""};scheduler.templates[M.name+"_tooltip"]=function(P,O,Q){return Q.text};scheduler.templates[M.name+"_date"]=function(P,O){return scheduler.templates.week_date(P,O)};scheduler.templates[M.name+"_scale_date"]=scheduler.date.date_to_str(M.x_date||scheduler.config.hour_date);scheduler.date[M.name+"_start"]=scheduler.date.day_start;scheduler.date["add_"+M.name]=function(P,O,Q){return scheduler.date.add(P,(M.x_length||M.x_size)*O*M.x_step,M.x_unit)};scheduler.attachEvent("onSchedulerResize",function(){if(this._mode==M.name){C.call(M,true);return false}return true});scheduler.attachEvent("onBeforeDrag",function(){return this._mode!=M.name})};function K(){var N=scheduler.getEvents(scheduler._min_date,scheduler._max_date);var M=[];for(var O=0;O<this.y_unit.length;O++){M[O]=[]}if(!M[P]){M[P]=[]}for(var O=0;O<N.length;O++){var P=this.order[N[O][this.y_property]];var L=0;while(this._trace_x[L+1]&&N[O].start_date>=this._trace_x[L+1]){L++}while(this._trace_x[L]&&N[O].end_date>this._trace_x[L]){if(!M[P][L]){M[P][L]=[]}M[P][L].push(N[O]);L++}}return M}function A(c){var T="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>";var U=[];if(this.render=="cell"){U=K.call(this)}else{var b=scheduler.getEvents(scheduler._min_date,scheduler._max_date);for(var X=0;X<b.length;X++){var Q=this.order[b[X][this.y_property]];if(!U[Q]){U[Q]=[]}U[Q].push(b[X])}}var W=0;for(var Y=0;Y<scheduler._cols.length;Y++){W+=scheduler._cols[Y]}var N=new Date();N=(scheduler.date.add(N,this.x_step*this.x_size,this.x_unit)-N)/W;var V=this.dy;if(this.y_unit.length*V<c.offsetHeight){V=Math.floor((c.offsetHeight-1)/this.y_unit.length)}for(var Y=0;Y<this.y_unit.length;Y++){T+="<tr style='height:"+V+"px'><td class='dhx_matrix_scell' style='width:"+(this.dx-1)+"px'>"+this.y_unit[Y].label+"</td>";if(this.render=="cell"){for(var X=0;X<scheduler._cols.length;X++){T+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](U[Y][X],this._trace_x[X],this.y_unit[Y])+"' style='width:"+(scheduler._cols[X]-1)+"px'><div  style='width:"+(scheduler._cols[X]-1)+"px'>"+scheduler.templates[this.name+"_cell_value"](U[Y][X])+"<div></td>"}}else{T+="<td><div style='width:"+W+"px; height:"+V+"px; position:relative;' class='dhx_matrix_line'>";if(U[Y]){U[Y].sort(function(e,d){return e.start_date>d.start_date?1:-1});var O=[];for(var X=0;X<U[Y].length;X++){var a=U[Y][X];var L=0;while(O[L]&&O[L].end_date>a.start_date){L++}O[L]=a;var S=Math.max(0,(a.start_date-scheduler._min_date)/N)*0.995;var Z=Math.min(W,(a.end_date-scheduler._min_date)/N);Z=Z*1.005-0.005*W;var P=scheduler.xy.bar_height;var R=2+L*P;var M=scheduler.templates.event_class(a.start_date,a.end_date,a);M="dhx_cal_event_line "+(M||"");T+='<div event_id="'+a.id+'" class="'+M+'" style="position:absolute; top:'+R+"px; left:"+S+"px; width:"+Math.max(0,Z-S-15)+"px;"+(a._text_style||"")+'">'+scheduler.templates.event_bar_text(a.start_date,a.end_date,a)+"</div>"}}T+="<table cellpadding='0' cellspacing='0' style='width:"+W+"px; height:"+V+"px'>";for(var X=0;X<scheduler._cols.length;X++){T+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](U[Y],this._trace_x[X],this.y_unit[Y])+"' style='width:"+(scheduler._cols[X]-1)+"px'><div  style='width:"+(scheduler._cols[X]-1)+"px'><div></td>"}T+="</table>";T+="</div></td>"}T+="</tr>"}T+="</table>";this._matrix=U;c.innerHTML=T}function E(N){N.innerHTML="<div></div>";N=N.firstChild;scheduler._cols=[];scheduler._colsS={height:0};this._trace_x=[];if(this.x_start){scheduler._min_date=scheduler.date.add(scheduler._min_date,this.x_start*this.x_step,this.x_unit)}var R=scheduler._min_date;var Q=scheduler._x-this.dx-18;var P=this.dx;for(var L=0;L<this.x_size;L++){scheduler._cols[L]=Math.floor(Q/(this.x_size-L));this._trace_x[L]=new Date(R);scheduler._render_x_header(L,P,R,N);var M=scheduler.templates[this.name+"_scalex_class"](R);if(M){N.lastChild.className+=" "+M}R=scheduler.date.add(R,this.x_step,this.x_unit);Q-=scheduler._cols[L];P+=scheduler._cols[L]}var O=this._trace_x;N.onclick=function(S){var T=B(S);if(T){scheduler.callEvent("onXScaleClick",[T.x,O[T.x]])}};N.ondblclick=function(S){var T=B(S);if(T){scheduler.callEvent("onXScaleDblClick",[T.x,O[T.x]])}}}function C(M){if(M){scheduler.set_sizes();F();var L=scheduler._min_date;E.call(this,scheduler._els.dhx_cal_header[0]);A.call(this,scheduler._els.dhx_cal_data[0]);scheduler._min_date=L;scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date);scheduler._table_view=true}}function H(){if(scheduler._tooltip){scheduler._tooltip.style.display="none";scheduler._tooltip.date=""}}function J(P,S,Q){if(P.render!="cell"){return }var R=S.x+"_"+S.y;var L=P._matrix[S.y][S.x];if(!L){return H()}if(scheduler._tooltip){if(scheduler._tooltip.date==R){return }scheduler._tooltip.innerHTML=""}else{var O=scheduler._tooltip=document.createElement("DIV");O.className="dhx_tooltip";document.body.appendChild(O);O.onclick=scheduler._click.dhx_cal_data}var N="";for(var M=0;M<L.length;M++){N+="<div class='dhx_tooltip_line' event_id='"+L[M].id+"'>";N+="<div class='dhx_tooltip_date'>"+(L[M]._timed?scheduler.templates.event_date(L[M].start_date):"")+"</div>";N+="<div class='dhx_event_icon icon_details'>&nbsp;</div>";N+=scheduler.templates[P.name+"_tooltip"](L[M].start_date,L[M].end_date,L[M])+"</div>"}scheduler._tooltip.style.display="";scheduler._tooltip.style.top="0px";if(document.body.offsetWidth-Q.left-scheduler._tooltip.offsetWidth<0){scheduler._tooltip.style.left=Q.left-scheduler._tooltip.offsetWidth+"px"}else{scheduler._tooltip.style.left=Q.left+S.src.offsetWidth+"px"}scheduler._tooltip.date=R;scheduler._tooltip.innerHTML=N;if(document.body.offsetHeight-Q.top-scheduler._tooltip.offsetHeight<0){scheduler._tooltip.style.top=Q.top-scheduler._tooltip.offsetHeight+S.src.offsetHeight+"px"}else{scheduler._tooltip.style.top=Q.top+"px"}}function F(){dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",function(M){var L=scheduler.matrix[scheduler._mode];if(L){var O=D(M);var M=M||event;var N=M.target||M.srcElement;if(O){return J(L,O,getOffset(O.src))}}H()});F=function(){}}scheduler.renderMatrix=function(L){scheduler._min_date=scheduler.date[this.name+"_start"](scheduler._date);scheduler._max_date=scheduler.date.add(scheduler._min_date,1,this.name);scheduler._table_view=true;C.call(this,L)};function G(M){var N=M.parentNode.childNodes;for(var L=0;L<N.length;L++){if(N[L]==M){return L}}return -1}function B(N){N=N||event;var L=N.target?N.target:N.srcElement;while(L&&L.tagName!="DIV"){L=L.parentNode}if(L&&L.tagName=="DIV"){var M=L.className.split(" ")[0];if(M=="dhx_scale_bar"){return{x:G(L),y:-1,src:L,scale:true}}}}function D(N){N=N||event;var L=N.target?N.target:N.srcElement;while(L&&L.tagName!="TD"){L=L.parentNode}if(L&&L.tagName=="TD"){var M=L.className.split(" ")[0];if(M=="dhx_matrix_cell"){return{x:L.cellIndex-1,y:L.parentNode.rowIndex,src:L}}else{if(M=="dhx_matrix_scell"){return{x:-1,y:L.parentNode.rowIndex,src:L,scale:true}}}}return false}var I=scheduler._click.dhx_cal_data;scheduler._click.dhx_cal_data=function(N){var L=I.apply(this,arguments);var M=scheduler.matrix[scheduler._mode];if(M){var O=D(N);if(O){if(O.scale){scheduler.callEvent("onYScaleClick",[O.y,M.y_unit[O.y]])}else{scheduler.callEvent("onCellClick",[O.x,O.y,M._trace_x[O.x],(((M._matrix[O.y]||{})[O.x])||[])])}}}return L};scheduler.dblclick_dhx_matrix_cell=function(M){var L=scheduler.matrix[scheduler._mode];if(L){var N=D(M);if(N){if(N.scale){scheduler.callEvent("onYScaleDblClick",[N.y,L.y_unit[N.y]])}else{scheduler.callEvent("onCellDblClick",[N.x,N.y,L._trace_x[N.x],(((L._matrix[N.y]||{})[N.x])||[])])}}}};scheduler.dblclick_dhx_matrix_scell=function(L){return scheduler.dblclick_dhx_matrix_cell(L)}})();